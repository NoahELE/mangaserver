import{r as E,c as q,u as K,e as F,i as W,f as Y,j as v,g as G,h as Q,R as X,k as Z}from"./react-04ee6a5c.js";import{B as T,T as P,C,R as A,a as z,F as _,I as O}from"./antd-9b20b38f.js";import{a as S}from"./axios-a900fd7e.js";import{c as B}from"./lodash-e042c751.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const d of e.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerpolicy&&(e.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?e.credentials="include":n.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(n){if(n.ep)return;n.ep=!0;const e=a(n);fetch(n.href,e)}})();var I={},V={get exports(){return I},set exports(o){I=o}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee=E,te=Symbol.for("react.element"),re=Symbol.for("react.fragment"),ne=Object.prototype.hasOwnProperty,oe=ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ae={key:!0,ref:!0,__self:!0,__source:!0};function U(o,t,a){var r,n={},e=null,d=null;a!==void 0&&(e=""+a),t.key!==void 0&&(e=""+t.key),t.ref!==void 0&&(d=t.ref);for(r in t)ne.call(t,r)&&!ae.hasOwnProperty(r)&&(n[r]=t[r]);if(o&&o.defaultProps)for(r in t=o.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:te,type:o,key:e,ref:d,props:n,_owner:oe.current}}x.Fragment=re;x.jsx=U;x.jsxs=U;(function(o){o.exports=x})(V);const k=I.Fragment,i=I.jsx,R=I.jsxs;var j={},M=q;j.createRoot=M.createRoot,j.hydrateRoot=M.hydrateRoot;const{Title:se,Text:ie}=P;function le(){const o=K(),t=F();let a;return W(o)?a=o.data.msg+"":a=o+"",R(k,{children:[i(se,{children:"Error"}),i(ie,{children:a}),i(T,{type:"primary",onClick:()=>t(-1),children:"Return to Last Page"}),i(T,{type:"default",onClick:()=>t("/login"),children:"Login"})]})}function ce(o){let t;try{t=o()}catch{return}return{getItem:r=>{var n;const e=h=>h===null?null:JSON.parse(h),d=(n=t.getItem(r))!=null?n:null;return d instanceof Promise?d.then(e):e(d)},setItem:(r,n)=>t.setItem(r,JSON.stringify(n)),removeItem:r=>t.removeItem(r)}}const $=o=>t=>{try{const a=o(t);return a instanceof Promise?a:{then(r){return $(r)(a)},catch(r){return this}}}catch(a){return{then(r){return this},catch(r){return $(r)(a)}}}},de=(o,t)=>(a,r,n)=>{let e={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:s=>s,version:0,merge:(s,c)=>({...c,...s}),...t},d=!1;const h=new Set,g=new Set;let m;try{m=e.getStorage()}catch{}if(!m)return o((...s)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),a(...s)},r,n);const w=$(e.serialize),b=()=>{const s=e.partialize({...r()});let c;const u=w({state:s,version:e.version}).then(y=>m.setItem(e.name,y)).catch(y=>{c=y});if(c)throw c;return u},L=n.setState;n.setState=(s,c)=>{L(s,c),b()};const f=o((...s)=>{a(...s),b()},r,n);let p;const l=()=>{var s;if(!m)return;d=!1,h.forEach(u=>u(r()));const c=((s=e.onRehydrateStorage)==null?void 0:s.call(e,r()))||void 0;return $(m.getItem.bind(m))(e.name).then(u=>{if(u)return e.deserialize(u)}).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==e.version){if(e.migrate)return e.migrate(u.state,u.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return u.state}).then(u=>{var y;return p=e.merge(u,(y=r())!=null?y:f),a(p,!0),b()}).then(()=>{c==null||c(p,void 0),d=!0,g.forEach(u=>u(p))}).catch(u=>{c==null||c(void 0,u)})};return n.persist={setOptions:s=>{e={...e,...s},s.getStorage&&(m=s.getStorage())},clearStorage:()=>{m==null||m.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>l(),hasHydrated:()=>d,onHydrate:s=>(h.add(s),()=>{h.delete(s)}),onFinishHydration:s=>(g.add(s),()=>{g.delete(s)})},l(),p||f},ue=(o,t)=>(a,r,n)=>{let e={storage:ce(()=>localStorage),partialize:l=>l,version:0,merge:(l,s)=>({...s,...l}),...t},d=!1;const h=new Set,g=new Set;let m=e.storage;if(!m)return o((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),a(...l)},r,n);const w=()=>{const l=e.partialize({...r()});return m.setItem(e.name,{state:l,version:e.version})},b=n.setState;n.setState=(l,s)=>{b(l,s),w()};const L=o((...l)=>{a(...l),w()},r,n);let f;const p=()=>{var l;if(!m)return;d=!1,h.forEach(c=>c(r()));const s=((l=e.onRehydrateStorage)==null?void 0:l.call(e,r()))||void 0;return Promise.resolve(m.getItem.bind(m)(e.name)).then(c=>{if(c)if(typeof c.version=="number"&&c.version!==e.version){if(e.migrate)return e.migrate(c.state,c.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return c.state}).then(c=>{var u;return f=e.merge(c,(u=r())!=null?u:L),a(f,!0),w()}).then(()=>{s==null||s(f,void 0),d=!0,g.forEach(c=>c(f))}).catch(c=>{s==null||s(void 0,c)})};return n.persist={setOptions:l=>{e={...e,...l},l.storage&&(m=l.storage)},clearStorage:()=>{m==null||m.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>p(),hasHydrated:()=>d,onHydrate:l=>(h.add(l),()=>{h.delete(l)}),onFinishHydration:l=>(g.add(l),()=>{g.delete(l)})},p(),f||L},me=(o,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Please use `storage` option instead."),de(o,t)):ue(o,t),he=me,D=Y()(he(o=>({jwt:"",setJwt:t=>o({jwt:t})}),{name:"mangaserver-storage"}));S.defaults.baseURL="/api";function H(){const{jwt:o}=D.getState();if(o.length!==0)S.defaults.headers.common.Authorization=`Bearer ${o}`;else throw v({msg:"jwt is empty"})}const N={async login(o){const{data:t}=await S.post("/user/login",o);if(t.code===0)return t.data;throw v({msg:`code: ${t.code}
login failed
${t.msg}`})},async getAllLibraries(){H();const{data:{code:o,data:t,msg:a}}=await S.get("/library");if(o===0)return t;throw v({msg:`code: ${o}
failed to get libraries
${a}`})},async getAllManga(o){H();const{data:{code:t,data:a,msg:r}}=await S.get(`/library/${o}/listManga`);if(t===0)return a;throw v({msg:`code: ${t}
failed to get manga
${r}`})}};function ge({library:o}){const{id:t,name:a,path:r}=o,n=F();return i(C,{hoverable:!0,onClick:()=>n(`/library/${t}`),children:i(C.Meta,{title:a,description:r})})}const{Title:fe}=P;function pe(){const[o,t]=E.useState([]);E.useEffect(()=>{N.getAllLibraries().then(t,r=>{throw r})},[]);const a=B(o,4).map((r,n)=>i(A,{gutter:16,children:r.map((e,d)=>i(z,{span:6,children:i(ge,{library:e})},`${n}-${d}`))},n));return R(k,{children:[i(fe,{children:"Library List"}),...a]})}const{Title:ye}=P;function ve(){const o=D(n=>n.setJwt),t=F();return R(k,{children:[i(ye,{style:{textAlign:"center",marginTop:100},children:"MangaServer"}),R(_,{labelCol:{span:8},wrapperCol:{span:16},onFinish:n=>{N.login(n).then(e=>{o(e),t("/")},e=>{throw e})},onFinishFailed:n=>{throw n},style:{marginLeft:500,marginRight:500},children:[i(_.Item,{name:"username",label:"Username",rules:[{required:!0,message:"please input your username"}],children:i(O,{})}),i(_.Item,{name:"password",label:"Password",rules:[{required:!0,message:"please input your password"}],children:i(O.Password,{})}),i(_.Item,{wrapperCol:{offset:8,span:16},children:i(T,{type:"primary",htmlType:"submit",children:"Login"})})]})]})}function we({manga:o}){const{id:t,name:a,path:r}=o,n=F();return i(C,{hoverable:!0,onClick:()=>n(`/manga/${t}`),cover:i("img",{alt:"manga cover",src:`/api/manga/${t}/page/0`}),children:i(C.Meta,{title:a,description:r})})}const{Title:be}=P;function Se(){const{libraryId:o}=G();if(o===void 0||o.length===0)throw v({msg:"libraryId does not exist"});const t=+o;if(isNaN(t))throw v({msg:"libraryId is not a number"});const[a,r]=E.useState([]);N.getAllManga(t).then(r,e=>{throw e});const n=B(a,4).map((e,d)=>i(A,{gutter:16,children:e.map((h,g)=>i(z,{span:6,children:i(we,{manga:h})},`${d}-${g}`))},d));return R(k,{children:[i(be,{children:"Manga List"}),...n]})}const Ie=Q([{path:"/",element:i(pe,{}),errorElement:i(le,{})},{path:"/login",element:i(ve,{})},{path:"/library/:libraryId",element:i(Se,{})}]),J=document.getElementById("root");J!==null&&j.createRoot(J).render(i(X.StrictMode,{children:i(Z,{router:Ie})}));
