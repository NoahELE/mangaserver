import{r as O,R as Y}from"./index-31cc1b08.js";let Z=0;function I(e,u){const a=`atom${++Z}`,R={toString:()=>a};return typeof e=="function"?R.read=e:(R.init=e,R.read=h=>h(R),R.write=(h,v,p)=>v(R,typeof p=="function"?p(h(R)):p)),u&&(R.write=u),R}const j=e=>"init"in e,k=e=>!!e.write,y=new WeakMap,Q=(e,u)=>{y.set(e,u),e.catch(()=>{}).finally(()=>y.delete(e))},z=(e,u)=>{const a=y.get(e);a&&(y.delete(e),a(u))},F=(e,u)=>{e.status="fulfilled",e.value=u},W=(e,u)=>{e.status="rejected",e.reason=u},tt=e=>typeof(e==null?void 0:e.then)=="function",m=(e,u)=>"v"in e&&"v"in u&&Object.is(e.v,u.v),J=(e,u)=>"e"in e&&"e"in u&&Object.is(e.e,u.e),w=e=>"v"in e&&e.v instanceof Promise,et=(e,u)=>"v"in e&&"v"in u&&e.v.orig&&e.v.orig===u.v.orig,P=e=>{if("e"in e)throw e.e;return e.v},ot=()=>{const e=new WeakMap,u=new WeakMap,a=new Map;let R,h;const v=t=>e.get(t),p=(t,n)=>{const s=e.get(t);if(e.set(t,n),a.has(t)||a.set(t,s),s&&w(s)){const o="v"in n?n.v instanceof Promise?n.v:Promise.resolve(n.v):Promise.reject(n.e);s.v!==o&&z(s.v,o)}},_=(t,n,s)=>{const o=new Map;let i=!1;s.forEach((c,r)=>{!c&&r===t&&(c=n),c&&(o.set(r,c),n.d.get(r)!==c&&(i=!0))}),(i||n.d.size!==o.size)&&(n.d=o)},D=(t,n,s)=>{const o=v(t),i={d:(o==null?void 0:o.d)||new Map,v:n};if(s&&_(t,i,s),o&&m(o,i)&&o.d===i.d)return o;if(o&&w(o)&&w(i)&&et(o,i)){if(o.d===i.d)return o;i.v=o.v}return p(t,i),i},A=(t,n,s,o)=>{if(tt(n)){let i;const c=new Promise((r,d)=>{let E=!1;n.then(l=>{if(!E){E=!0;const f=v(t),S=D(t,c,s);F(c,l),r(l),u.has(t)&&(f==null?void 0:f.d)!==S.d&&U(t,S,f==null?void 0:f.d)}},l=>{if(!E){E=!0;const f=v(t),S=D(t,c,s);W(c,l),d(l),u.has(t)&&(f==null?void 0:f.d)!==S.d&&U(t,S,f==null?void 0:f.d)}}),i=l=>{E||(E=!0,l.then(f=>F(c,f),f=>W(c,f)),r(l))}});return c.orig=n,c.status="pending",Q(c,r=>{r&&i(r),o==null||o()}),D(t,c,s)}return D(t,n,s)},M=(t,n,s)=>{const o=v(t),i={d:(o==null?void 0:o.d)||new Map,e:n};return s&&_(t,i,s),o&&J(o,i)&&o.d===i.d?o:(p(t,i),i)},g=(t,n)=>{const s=v(t);if(!n&&s&&(u.has(t)||Array.from(s.d).every(([l,f])=>l===t||g(l)===f)))return s;const o=new Map;let i=!0;const c=l=>{if(l===t){const S=v(l);if(S)return o.set(l,S),P(S);if(j(l))return o.set(l,void 0),l.init;throw new Error("no atom init")}const f=g(l);return o.set(l,f),P(f)};let r,d;const E={get signal(){return r||(r=new AbortController),r.signal},get setSelf(){return!d&&k(t)&&(d=(...l)=>{if(!i)return L(t,...l)}),d}};try{const l=t.read(c,E);return A(t,l,o,()=>r==null?void 0:r.abort())}catch(l){return M(t,l,o)}finally{i=!1}},$=t=>P(g(t)),G=t=>{let n=u.get(t);return n||(n=V(t)),n},b=(t,n)=>!n.l.size&&(!n.t.size||n.t.size===1&&n.t.has(t)),H=t=>{const n=u.get(t);n&&b(t,n)&&B(t)},K=t=>{const n=new Map,s=new WeakMap,o=r=>{var d;const E=new Set((d=u.get(r))==null?void 0:d.t);return a.forEach((l,f)=>{var S;(S=v(f))!=null&&S.d.has(r)&&E.add(f)}),E},i=r=>{o(r).forEach(d=>{d!==r&&(n.set(d,(n.get(d)||new Set).add(r)),s.set(d,(s.get(d)||0)+1),i(d))})};i(t);const c=r=>{o(r).forEach(d=>{var E;if(d!==r){let l=s.get(d);if(l&&s.set(d,--l),!l){let f=!!((E=n.get(d))!=null&&E.size);if(f){const S=v(d),X=g(d,!0);f=!S||!m(S,X)}f||n.forEach(S=>S.delete(d))}c(d)}})};c(t)},N=(t,...n)=>{let s=!0;const o=r=>P(g(r)),i=(r,...d)=>{let E;if(r===t){if(!j(r))throw new Error("atom not writable");const l=v(r),f=A(r,d[0]);(!l||!m(l,f))&&K(r)}else E=N(r,...d);if(!s){const l=T()}return E},c=t.write(o,i,...n);return s=!1,c},L=(t,...n)=>{const s=N(t,...n),o=T();return s},V=(t,n,s)=>{var o;const i=s||[];(o=v(t))==null||o.d.forEach((r,d)=>{const E=u.get(d);E?E.t.add(t):d!==t&&V(d,t,i)}),g(t);const c={t:new Set(n&&[n]),l:new Set};if(u.set(t,c),k(t)&&t.onMount){const{onMount:r}=t;i.push(()=>{const d=r((...E)=>L(t,...E));d&&(c.u=d)})}return s||i.forEach(r=>r()),c},B=t=>{var n;const s=(n=u.get(t))==null?void 0:n.u;s&&s(),u.delete(t);const o=v(t);o&&(w(o)&&z(o.v),o.d.forEach((i,c)=>{if(c!==t){const r=u.get(c);r&&(r.t.delete(t),b(c,r)&&B(c))}}))},U=(t,n,s)=>{const o=new Set(n.d.keys());s==null||s.forEach((i,c)=>{if(o.has(c)){o.delete(c);return}const r=u.get(c);r&&(r.t.delete(t),b(c,r)&&B(c))}),o.forEach(i=>{const c=u.get(i);c?c.t.add(t):u.has(t)&&V(i,t)})},T=()=>{let t;for(;a.size;){const n=Array.from(a);a.clear(),n.forEach(([s,o])=>{const i=v(s);if(i){const c=u.get(s);c&&i.d!==(o==null?void 0:o.d)&&U(s,i,o==null?void 0:o.d),c&&!(o&&!w(o)&&(m(o,i)||J(o,i)))&&c.l.forEach(r=>r())}})}};return{get:$,set:L,sub:(t,n)=>{const s=G(t),o=T(),i=s.l;return i.add(n),()=>{i.delete(n),H(t)}}}};let C;const q=()=>(C||(C=ot()),C),nt=O.createContext(void 0),x=e=>{const u=O.useContext(nt);return(e==null?void 0:e.store)||u||q()},st=e=>typeof(e==null?void 0:e.then)=="function",rt=Y.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(u=>{e.status="fulfilled",e.value=u},u=>{e.status="rejected",e.reason=u}),e)});function ct(e,u){const a=x(u),[[R,h,v],p]=O.useReducer(A=>{const M=a.get(e);return Object.is(A[0],M)&&A[1]===a&&A[2]===e?A:[M,a,e]},void 0,()=>[a.get(e),a,e]);let _=R;(h!==a||v!==e)&&(p(),_=a.get(e));const D=u==null?void 0:u.delay;return O.useEffect(()=>{const A=a.sub(e,()=>{if(typeof D=="number"){setTimeout(p,D);return}p()});return p(),A},[a,e,D]),O.useDebugValue(_),st(_)?rt(_):_}function lt(e,u){const a=x(u);return O.useCallback((...h)=>a.set(e,...h),[a,e])}q();const dt=I(null),ft=I(null),at=I(null);export{at as a,lt as b,dt as c,ft as l,ct as u};
