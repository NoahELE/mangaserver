import{r as m,R as Y}from"./index-50bb302d.js";let Z=0;function C(t,u){const a=`atom${++Z}`,S={toString:()=>a};return typeof t=="function"?S.read=t:(S.init=t,S.read=p=>p(S),S.write=(p,L,E)=>L(S,typeof E=="function"?E(p(S)):E)),u&&(S.write=u),S}const W=t=>"init"in t,I=t=>!!t.write,_=new WeakMap,ee=(t,u)=>{_.set(t,u),t.catch(()=>{}).finally(()=>_.delete(t))},q=(t,u)=>{const a=_.get(t);a&&(_.delete(t),a(u))},x=(t,u)=>{t.status="fulfilled",t.value=u},F=(t,u)=>{t.status="rejected",t.reason=u},te=t=>typeof(t==null?void 0:t.then)=="function",M=(t,u)=>"v"in t&&"v"in u&&Object.is(t.v,u.v),T=(t,u)=>"e"in t&&"e"in u&&Object.is(t.e,u.e),w=t=>"v"in t&&t.v instanceof Promise,oe=(t,u)=>"v"in t&&"v"in u&&t.v.orig&&t.v.orig===u.v.orig,P=t=>{if("e"in t)throw t.e;return t.v},ne=()=>{const t=new WeakMap,u=new WeakMap,a=new Map;let S,p,L;const E=e=>t.get(e),h=(e,o)=>{const r=t.get(e);if(t.set(e,o),a.has(e)||a.set(e,r),r&&w(r)){const n="v"in o?o.v instanceof Promise?o.v:Promise.resolve(o.v):Promise.reject(o.e);q(r.v,n)}},D=(e,o,r)=>{const n=new Map;let i=!1;r.forEach((s,c)=>{!s&&c===e&&(s=o),s&&(n.set(c,s),o.d.get(c)!==s&&(i=!0))}),(i||o.d.size!==n.size)&&(o.d=n)},R=(e,o,r)=>{const n=E(e),i={d:(n==null?void 0:n.d)||new Map,v:o};if(r&&D(e,i,r),n&&M(n,i)&&n.d===i.d)return n;if(n&&w(n)&&w(i)&&oe(n,i)){if(n.d===i.d)return n;i.v=n.v}return h(e,i),i},O=(e,o,r,n)=>{if(te(o)){let i;const s=new Promise((c,v)=>{let l=!1;o.then(f=>{if(!l){l=!0;const d=E(e),A=R(e,s,r);x(s,f),c(f),(d==null?void 0:d.d)!==A.d&&U(e,A,d==null?void 0:d.d)}},f=>{if(!l){l=!0;const d=E(e),A=R(e,s,r);F(s,f),v(f),(d==null?void 0:d.d)!==A.d&&U(e,A,d==null?void 0:d.d)}}),i=f=>{l||(l=!0,f.then(d=>x(s,d),d=>F(s,d)),c(f))}});return s.orig=o,s.status="pending",ee(s,c=>{c&&i(c),n==null||n()}),R(e,s,r)}return R(e,o,r)},H=(e,o,r)=>{const n=E(e),i={d:(n==null?void 0:n.d)||new Map,e:o};return r&&D(e,i,r),n&&T(n,i)&&n.d===i.d?n:(h(e,i),i)},g=e=>{const o=E(e);if(o&&(o.d.forEach((l,f)=>{f!==e&&!u.has(f)&&g(f)}),Array.from(o.d).every(([l,f])=>{const d=E(l);return l===e||d===f||d&&!w(d)&&M(d,f)})))return o;const r=new Map;let n=!0;const i=l=>{if(l===e){const d=E(l);if(d)return r.set(l,d),P(d);if(W(l))return r.set(l,void 0),l.init;throw new Error("no atom init")}const f=g(l);return r.set(l,f),P(f)};let s,c;const v={get signal(){return s||(s=new AbortController),s.signal},get setSelf(){return!c&&I(e)&&(c=(...l)=>{if(!n)return V(e,...l)}),c}};try{const l=e.read(i,v);return O(e,l,r,()=>s==null?void 0:s.abort())}catch(l){return H(e,l,r)}finally{n=!1}},J=e=>P(g(e)),K=e=>{let o=u.get(e);return o||(o=b(e)),o},y=(e,o)=>!o.l.size&&(!o.t.size||o.t.size===1&&o.t.has(e)),N=e=>{const o=u.get(e);o&&y(e,o)&&B(e)},Q=e=>{const o=new Map,r=new WeakMap,n=s=>{const c=u.get(s);c==null||c.t.forEach(v=>{v!==s&&(o.set(v,(o.get(v)||new Set).add(s)),r.set(v,(r.get(v)||0)+1),n(v))})};n(e);const i=s=>{const c=u.get(s);c==null||c.t.forEach(v=>{var l;if(v!==s){let f=r.get(v);if(f&&r.set(v,--f),!f){let d=!!((l=o.get(v))!=null&&l.size);if(d){const A=E(v),X=g(v);d=!A||!M(A,X)}d||o.forEach(A=>A.delete(v))}i(v)}})};i(e)},z=(e,...o)=>{let r=!0;const n=c=>P(g(c)),i=(c,...v)=>{let l;if(c===e){if(!W(c))throw new Error("atom not writable");const f=E(c),d=O(c,v[0]);(!f||!M(f,d))&&Q(c)}else l=z(c,...v);if(!r){const f=k()}return l},s=e.write(n,i,...o);return r=!1,s},V=(e,...o)=>{const r=z(e,...o),n=k();return r},b=(e,o)=>{const r={t:new Set(o&&[o]),l:new Set};if(u.set(e,r),g(e).d.forEach((n,i)=>{const s=u.get(i);s?s.t.add(e):i!==e&&b(i,e)}),g(e),I(e)&&e.onMount){const n=e.onMount((...i)=>V(e,...i));n&&(r.u=n)}return r},B=e=>{var o;const r=(o=u.get(e))==null?void 0:o.u;r&&r(),u.delete(e);const n=E(e);n&&(w(n)&&q(n.v),n.d.forEach((i,s)=>{if(s!==e){const c=u.get(s);c&&(c.t.delete(e),y(s,c)&&B(s))}}))},U=(e,o,r)=>{const n=new Set(o.d.keys());r==null||r.forEach((i,s)=>{if(n.has(s)){n.delete(s);return}const c=u.get(s);c&&(c.t.delete(e),y(s,c)&&B(s))}),n.forEach(i=>{const s=u.get(i);s?s.t.add(e):u.has(e)&&b(i,e)})},k=()=>{let e;for(;a.size;){const o=Array.from(a);a.clear(),o.forEach(([r,n])=>{const i=E(r);if(i){i.d!==(n==null?void 0:n.d)&&U(r,i,n==null?void 0:n.d);const s=u.get(r);s&&!(n&&!w(n)&&(M(n,i)||T(n,i)))&&s.l.forEach(c=>c())}})}};return{get:J,set:V,sub:(e,o)=>{const r=K(e),n=k(),i=r.l;return i.add(o),()=>{i.delete(o),N(e)}}}};let j;const $=()=>(j||(j=ne()),j),se=m.createContext(void 0),G=t=>{const u=m.useContext(se);return(t==null?void 0:t.store)||u||$()},re=t=>typeof(t==null?void 0:t.then)=="function",ie=Y.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(u=>{t.status="fulfilled",t.value=u},u=>{t.status="rejected",t.reason=u}),t)});function le(t,u){const a=G(u),[[S,p,L],E]=m.useReducer(R=>{const O=a.get(t);return Object.is(R[0],O)&&R[1]===a&&R[2]===t?R:[O,a,t]},void 0,()=>[a.get(t),a,t]);let h=S;(p!==a||L!==t)&&(E(),h=a.get(t));const D=u==null?void 0:u.delay;return m.useEffect(()=>{const R=a.sub(t,()=>{if(typeof D=="number"){setTimeout(E,D);return}E()});return E(),R},[a,t,D]),m.useDebugValue(h),re(h)?ie(h):h}function de(t,u){const a=G(u);return m.useCallback((...p)=>a.set(t,...p),[a,t])}$();const fe=C(null),ae=C(null),ve=C(null);export{ve as a,le as b,fe as c,ae as l,de as u};
